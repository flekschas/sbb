!function(a){"function"==typeof define&&define.amd?define("object"!=typeof document||"loading"!==document.readyState?[]:"html5-history-api",a):a()}(function(){function emptyFunction(){}function parseURL(a,b,c){var d=/(?:(\w+\:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/;if(null==a||""===a||b)a=b?a:windowLocation.href,(!isSupportHistoryAPI||c)&&(a=a.replace(/^[^#]*/,"")||"#",a=windowLocation.protocol.replace(/:.*$|$/,":")+"//"+windowLocation.host+settings.basepath+a.replace(new RegExp("^#[/]?(?:"+settings.type+")?"),""));else{var e=parseURL(),f=document.getElementsByTagName("base")[0];!c&&f&&f.getAttribute("href")&&(f.href=f.href,e=parseURL(f.href,null,!0));var g=e._pathname,h=e._protocol;a=""+a,a=/^(?:\w+\:)?\/\//.test(a)?0===a.indexOf("/")?h+a:a:h+"//"+e._host+(0===a.indexOf("/")?a:0===a.indexOf("?")?g+a:0===a.indexOf("#")?g+e._search+a:g.replace(/[^\/]+$/g,"")+a)}anchorElement.href=a;var i=d.exec(anchorElement.href),j=i[2]+(i[3]?":"+i[3]:""),k=i[4]||"/",l=i[5]||"",m="#"===i[6]?"":i[6]||"",n=k+l+m,o=k.replace(new RegExp("^"+settings.basepath,"i"),settings.type)+l;return{_href:i[1]+"//"+j+n,_protocol:i[1],_host:j,_hostname:i[2],_port:i[3]||"",_pathname:k,_search:l,_hash:m,_relative:n,_nohash:o,_special:o+m}}function storageInitialize(){var a;try{a=global.sessionStorage,a.setItem(sessionStorageKey+"t","1"),a.removeItem(sessionStorageKey+"t")}catch(b){a={getItem:function(a){var b=document.cookie.split(a+"=");return b.length>1&&b.pop().split(";").shift()||"null"},setItem:function(a){var b={};(b[windowLocation.href]=historyObject.state)&&(document.cookie=a+"="+JSON.stringify(b))}}}try{stateStorage=JSON.parse(a.getItem(sessionStorageKey))||{}}catch(b){stateStorage={}}addEvent(eventNamePrefix+"unload",function(){a.setItem(sessionStorageKey,JSON.stringify(stateStorage))},!1)}function redefineProperty(a,b,c,d){var e=0;c||(c={set:emptyFunction},e=1);var f=!c.set,g=!c.get,h={configurable:!0,set:function(){f=1},get:function(){g=1}};try{defineProperty(a,b,h),a[b]=a[b],defineProperty(a,b,c)}catch(i){}if(!(f&&g||(a.__defineGetter__&&(a.__defineGetter__(b,h.get),a.__defineSetter__(b,h.set),a[b]=a[b],c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)),f&&g))){if(e)return!1;if(a===global){try{var j=a[b];a[b]=null}catch(i){}if("execScript"in global)global.execScript("Public "+b,"VBScript"),global.execScript("var "+b+";","JavaScript");else try{defineProperty(a,b,{value:emptyFunction})}catch(i){}a[b]=j}else try{try{var k=Object.create(a);defineProperty(Object.getPrototypeOf(k)===a?k:a,b,c);for(var l in a)"function"==typeof a[l]&&(k[l]=a[l].bind(a));try{d.call(k,k,a)}catch(i){}a=k}catch(i){defineProperty(a.constructor.prototype,b,c)}}catch(i){return!1}}return a}function prepareDescriptorsForObject(a,b,c){return c=c||{},a=a===locationDescriptors?windowLocation:a,c.set=c.set||function(c){a[b]=c},c.get=c.get||function(){return a[b]},c}function addEventListener(a,b,c){a in eventsList?eventsList[a].push(b):arguments.length>3?addEvent(a,b,c,arguments[3]):addEvent(a,b,c)}function removeEventListener(a,b,c){var d=eventsList[a];if(d){for(var e=d.length;e--;)if(d[e]===b){d.splice(e,1);break}}else removeEvent(a,b,c)}function dispatchEvent(a,b){var c=(""+("string"==typeof a?a:a.type)).replace(/^on/,""),d=eventsList[c];if(d){if(b="string"==typeof a?b:a,null==b.target)for(var e=["target","currentTarget","srcElement","type"];a=e.pop();)b=redefineProperty(b,a,{get:"type"===a?function(){return c}:function(){return global}});(("popstate"===c?global.onpopstate:global.onhashchange)||emptyFunction).call(global,b);for(var f=0,g=d.length;g>f;f++)d[f].call(global,b);return!0}return dispatch(a,b)}function firePopState(){var a=document.createEvent?document.createEvent("Event"):document.createEventObject();a.initEvent?a.initEvent("popstate",!1,!1):a.type="popstate",a.state=historyObject.state,dispatchEvent(a)}function fireInitialState(){isFireInitialState&&(isFireInitialState=!1,firePopState())}function changeState(a,b,c,d){if(isSupportHistoryAPI)lastURL=windowLocation.href;else{0===isUsedHistoryLocationFlag&&(isUsedHistoryLocationFlag=2);var e=parseURL(b,2===isUsedHistoryLocationFlag&&-1!==(""+b).indexOf("#"));e._relative!==parseURL()._relative&&(lastURL=d,c?windowLocation.replace("#"+e._special):windowLocation.hash=e._special)}!isSupportStateObjectInHistory&&a&&(stateStorage[windowLocation.href]=a),isFireInitialState=!1}function onHashChange(a){var b=lastURL;if(lastURL=windowLocation.href,b){checkUrlForPopState!==windowLocation.href&&firePopState(),a=a||global.event;var c=parseURL(b,!0),d=parseURL();a.oldURL||(a.oldURL=c._href,a.newURL=d._href),c._hash!==d._hash&&dispatchEvent(a)}}function onLoad(a){setTimeout(function(){addEvent("popstate",function(a){checkUrlForPopState=windowLocation.href,isSupportStateObjectInHistory||(a=redefineProperty(a,"state",{get:function(){return historyObject.state}})),dispatchEvent(a)},!1)},0),!isSupportHistoryAPI&&a!==!0&&"location"in historyObject&&(scrollToAnchorId(locationObject.hash),fireInitialState())}function anchorTarget(a){for(;a;){if("A"===a.nodeName)return a;a=a.parentNode}}function onAnchorClick(a){var b=a||global.event,c=anchorTarget(b.target||b.srcElement),d="defaultPrevented"in b?b.defaultPrevented:b.returnValue===!1;if(c&&"A"===c.nodeName&&!d){var e=parseURL(),f=parseURL(c.getAttribute("href",2)),g=e._href.split("#").shift()===f._href.split("#").shift();g&&f._hash&&(e._hash!==f._hash&&(locationObject.hash=f._hash),scrollToAnchorId(f._hash),b.preventDefault?b.preventDefault():b.returnValue=!1)}}function scrollToAnchorId(a){var b=document.getElementById(a=(a||"").replace(/^#/,""));if(b&&b.id===a&&"A"===b.nodeName){var c=b.getBoundingClientRect();global.scrollTo(documentElement.scrollLeft||0,c.top+(documentElement.scrollTop||0)-(documentElement.clientTop||0))}}function initialize(){var a=document.getElementsByTagName("script"),b=(a[a.length-1]||{}).src||"",c=-1!==b.indexOf("?")?b.split("?").pop():"";c.replace(/(\w+)(?:=([^&]*))?/g,function(a,b,c){settings[b]=(c||"").replace(/^(0|false)$/,"")}),ie6DriverStart(),addEvent(eventNamePrefix+"hashchange",onHashChange,!1);var d=[locationDescriptors,locationObject,eventsDescriptors,global,historyDescriptors,historyObject];isSupportStateObjectInHistory&&delete historyDescriptors.state;for(var e=0;e<d.length;e+=2)for(var f in d[e])if(d[e].hasOwnProperty(f))if("function"==typeof d[e][f])d[e+1][f]=d[e][f];else{var g=prepareDescriptorsForObject(d[e],f,d[e][f]);if(!redefineProperty(d[e+1],f,g,function(a,b){b===historyObject&&(global.history=historyObject=d[e+1]=a)}))return removeEvent(eventNamePrefix+"hashchange",onHashChange,!1),!1;d[e+1]===global&&(eventsList[f]=eventsList[f.substr(2)]=[])}return historyObject.setup(),settings.redirect&&historyObject.redirect(),!isSupportStateObjectInHistory&&JSON&&storageInitialize(),isSupportHistoryAPI||document[addEventListenerName](eventNamePrefix+"click",onAnchorClick,!1),"complete"===document.readyState?onLoad(!0):(isSupportHistoryAPI||parseURL()._relative===settings.basepath||(isFireInitialState=!0),addEvent(eventNamePrefix+"load",onLoad,!1)),!0}function ie6DriverStart(){function createVBObjects(a){var b=[],c="VBHistoryClass"+(new Date).getTime()+msie++,d=["Class "+c];for(var e in a)if(a.hasOwnProperty(e)){var f=a[e];f&&(f.get||f.set)?(f.get&&d.push("Public "+("_"===e?"Default ":"")+"Property Get ["+e+"]","Call VBCVal([(accessors)].["+e+"].get.call(me),["+e+"])","End Property"),f.set&&d.push("Public Property Let ["+e+"](val)",f="Call [(accessors)].["+e+"].set.call(me,val)\nEnd Property","Public Property Set ["+e+"](val)",f)):(b.push(e),d.push("Public ["+e+"]"))}d.push("Private [(accessors)]","Private Sub Class_Initialize()","Set [(accessors)]="+c+"FactoryJS()","End Sub","End Class","Function "+c+"Factory()","Set "+c+"Factory=New "+c,"End Function"),global.execScript(d.join("\n"),"VBScript"),global[c+"FactoryJS"]=function(){return a};for(var g=global[c+"Factory"](),h=0;h<b.length;h++)g[b[h]]=a[b[h]];return g}function quote(a){var b=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return b.test(a)?'"'+a.replace(b,function(a){return a in c?c[a]:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}var msie=global.eval&&eval("/*@cc_on 1;@*/");if(msie&&!(document.documentMode&&document.documentMode>7)){var originalChangeState=changeState,originalRedefineProperty=redefineProperty,currentHref=parseURL()._href,iFrame=document.createElement("iframe");iFrame.src="javascript:true;",iFrame=documentElement.firstChild.appendChild(iFrame).contentWindow,global.execScript("Public history\nFunction VBCVal(o,r) If IsObject(o) Then Set r=o Else r=o End If End Function","VBScript"),locationObject={_:{get:locationDescriptors.toString}},historyObject={back:windowHistory.back,forward:windowHistory.forward,go:windowHistory.go,emulate:null,_:{get:function(){return"[object History]"}}},JSON={parse:function(a){try{return new Function("","return "+a)()}catch(b){return null}},stringify:function(a){var b=(typeof a).charCodeAt(2);return 114===b?quote(a):109===b?isFinite(a)?String(a):"null":111===b||108===b?String(a):106===b?a?function(b){var c=b?"[":"{";if(b)for(var d=0;d<a.length;d++)c+=(0==d?"":",")+JSON.stringify(a[d]);else for(var e in a)a.hasOwnProperty(e)&&(c+=(1==c.length?"":",")+quote(e)+":"+JSON.stringify(a[e]));return c+(b?"]":"}")}("[object Array]"===Object.prototype.toString.call(a)):"null":"void 0"}},changeState=function(a,b,c,d,e){var f=iFrame.document;0===isUsedHistoryLocationFlag&&(isUsedHistoryLocationFlag=2);var g=parseURL(b,2===isUsedHistoryLocationFlag&&-1!==(""+b).indexOf("#"));return isFireInitialState=!1,g._relative!==parseURL()._relative||e?(lastURL=d,c?iFrame.lfirst?(history.back(),changeState(a,g._href,0,d,1)):windowLocation.replace("#"+g._special):(g._href!=currentHref||e)&&(iFrame.lfirst?e&&(e=0,a=stateStorage[windowLocation.href]):(iFrame.lfirst=1,changeState(a,currentHref,0,d,1)),f.open(),f.write('<script>lfirst=1;parent.location.hash="'+g._special.replace(/"/g,'\\"')+'";</script>'),f.close()),void(!e&&a&&(stateStorage[windowLocation.href]=a))):void(a&&(stateStorage[windowLocation.href]=a))},redefineProperty=function(a,b,c){return originalRedefineProperty.apply(this,arguments)||(a===locationObject?locationObject[b]=c:a===historyObject?(historyObject[b]=c,"state"===b&&(locationObject=createVBObjects(locationObject),global.history=historyObject=createVBObjects(historyObject),global.execScript("var history = window.history;","JavaScript"))):a[b]=c.get&&c.get()),a};var interval=setInterval(function(){var a=parseURL()._href;if(a!=currentHref){var b=document.createEventObject();b.oldURL=currentHref,b.newURL=currentHref=a,b.type="hashchange",onHashChange(b)}},100);global.JSON=JSON}}var global=("object"==typeof window?window:this)||{};if(!global.history||"emulate"in global.history)return global.history;var document=global.document,documentElement=document.documentElement,Object=global.Object,JSON=global.JSON,windowLocation=global.location,windowHistory=global.history,historyObject=windowHistory,historyPushState=windowHistory.pushState,historyReplaceState=windowHistory.replaceState,isSupportHistoryAPI=!!historyPushState,isSupportStateObjectInHistory="state"in windowHistory,defineProperty=Object.defineProperty,locationObject=redefineProperty({},"t")?{}:document.createElement("a"),eventNamePrefix="",addEventListenerName=global.addEventListener?"addEventListener":(eventNamePrefix="on")&&"attachEvent",removeEventListenerName=global.removeEventListener?"removeEventListener":"detachEvent",dispatchEventName=global.dispatchEvent?"dispatchEvent":"fireEvent",addEvent=global[addEventListenerName],removeEvent=global[removeEventListenerName],dispatch=global[dispatchEventName],settings={basepath:"/",redirect:0,type:"/"},sessionStorageKey="__historyAPI__",anchorElement=document.createElement("a"),lastURL=windowLocation.href,checkUrlForPopState="",isFireInitialState=!1,isUsedHistoryLocationFlag=0,stateStorage={},eventsList={},lastTitle=document.title,eventsDescriptors={onhashchange:null,onpopstate:null},fastFixChrome=function(a,b){var c=global.history!==windowHistory;c&&(global.history=windowHistory),a.apply(windowHistory,b),c&&(global.history=historyObject)},historyDescriptors={setup:function(a,b,c){settings.basepath=(""+(null==a?settings.basepath:a)).replace(/(?:^|\/)[^\/]*$/,"/"),settings.type=null==b?settings.type:b,settings.redirect=null==c?settings.redirect:!!c},redirect:function(a,b){if(historyObject.setup(b,a),b=settings.basepath,global.top==global.self){var c=parseURL(null,!1,!0)._relative,d=windowLocation.pathname+windowLocation.search;isSupportHistoryAPI?(d=d.replace(/([^\/])$/,"$1/"),c!=b&&new RegExp("^"+b+"$","i").test(d)&&windowLocation.replace(c)):d!=b&&(d=d.replace(/([^\/])\?/,"$1/?"),new RegExp("^"+b,"i").test(d)&&windowLocation.replace(b+"#"+d.replace(new RegExp("^"+b,"i"),settings.type)+windowLocation.hash))}},pushState:function(a,b,c){var d=document.title;null!=lastTitle&&(document.title=lastTitle),historyPushState&&fastFixChrome(historyPushState,arguments),changeState(a,c),document.title=d,lastTitle=b},replaceState:function(a,b,c){var d=document.title;null!=lastTitle&&(document.title=lastTitle),delete stateStorage[windowLocation.href],historyReplaceState&&fastFixChrome(historyReplaceState,arguments),changeState(a,c,!0),document.title=d,lastTitle=b},location:{set:function(a){0===isUsedHistoryLocationFlag&&(isUsedHistoryLocationFlag=1),global.location=a},get:function(){return 0===isUsedHistoryLocationFlag&&(isUsedHistoryLocationFlag=1),isSupportHistoryAPI?windowLocation:locationObject}},state:{get:function(){return stateStorage[windowLocation.href]||null}}},locationDescriptors={assign:function(a){0===(""+a).indexOf("#")?changeState(null,a):windowLocation.assign(a)},reload:function(){windowLocation.reload()},replace:function(a){0===(""+a).indexOf("#")?changeState(null,a,!0):windowLocation.replace(a)},toString:function(){return this.href},href:{get:function(){return parseURL()._href}},protocol:null,host:null,hostname:null,port:null,pathname:{get:function(){return parseURL()._pathname}},search:{get:function(){return parseURL()._search}},hash:{set:function(a){changeState(null,(""+a).replace(/^(#|)/,"#"),!1,lastURL)},get:function(){return parseURL()._hash}}};return initialize()?(historyObject.emulate=!isSupportHistoryAPI,global[addEventListenerName]=addEventListener,global[removeEventListenerName]=removeEventListener,global[dispatchEventName]=dispatchEvent,historyObject):void 0});